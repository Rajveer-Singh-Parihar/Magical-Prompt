<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Option Call Analyzer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
</head>
<body class="bg-gray-100">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 1.5rem;
        }

        .title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            color: #1a1a1a;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-label {
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #4b5563;
        }

        .input-field {
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 1rem;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .result-card {
            background: #f3f4f6;
            padding: 1rem;
            border-radius: 6px;
        }

        .result-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.25rem;
        }

        .result-value {
            font-size: 1.25rem;
            font-weight: bold;
            color: #1a1a1a;
        }

        .chart-container {
            height: 400px;
            margin-top: 2rem;
        }

        .profit {
            color: #059669;
        }

        .loss {
            color: #dc2626;
        }
    </style>

    <div class="container">
        <div class="card">
            <h1 class="title">Stock Option Call Analyzer</h1>
            
            <div class="input-grid">
                <div class="input-group">
                    <label class="input-label">Stock Price ($)</label>
                    <input type="number" id="stockPrice" class="input-field" value="100">
                </div>
                <div class="input-group">
                    <label class="input-label">Strike Price ($)</label>
                    <input type="number" id="strikePrice" class="input-field" value="105">
                </div>
                <div class="input-group">
                    <label class="input-label">Days to Expiry</label>
                    <input type="number" id="daysToExpiry" class="input-field" value="30">
                </div>
                <div class="input-group">
                    <label class="input-label">Volatility (%)</label>
                    <input type="number" id="volatility" class="input-field" value="25">
                </div>
                <div class="input-group">
                    <label class="input-label">Risk-Free Rate (%)</label>
                    <input type="number" id="riskFreeRate" class="input-field" value="3.5">
                </div>
                <div class="input-group">
                    <label class="input-label">Option Price ($)</label>
                    <input type="number" id="optionPrice" class="input-field" value="2.50">
                </div>
            </div>

            <div class="results-grid">
                <div class="result-card">
                    <div class="result-label">Break-Even Price</div>
                    <div class="result-value" id="breakEven">$0.00</div>
                </div>
                <div class="result-card">
                    <div class="result-label">Max Loss</div>
                    <div class="result-value loss" id="maxLoss">$0.00</div>
                </div>
                <div class="result-card">
                    <div class="result-label">Max Gain</div>
                    <div class="result-value profit" id="maxGain">Unlimited</div>
                </div>
                <div class="result-card">
                    <div class="result-label">Return on Investment</div>
                    <div class="result-value" id="roi">0%</div>
                </div>
                <div class="result-card">
                    <div class="result-label">Probability of Profit</div>
                    <div class="result-value" id="profitProb">0%</div>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="profitChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // Initialize chart
        const ctx = document.getElementById('profitChart').getContext('2d');
        let profitChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Profit/Loss',
                    data: [],
                    borderColor: '#2563eb',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Stock Price ($)'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Profit/Loss ($)'
                        }
                    }
                }
            }
        });

        // Calculate Black-Scholes delta approximation
        function calculateDelta(S, K, T, v, r) {
            const d1 = (Math.log(S / K) + (r + v * v / 2) * T) / (v * Math.sqrt(T));
            return 0.5 * (1 + Math.erf(d1 / Math.sqrt(2)));
        }

        // Error function implementation
        Math.erf = function(x) {
            const a1 =  0.254829592;
            const a2 = -0.284496736;
            const a3 =  1.421413741;
            const a4 = -1.453152027;
            const a5 =  1.061405429;
            const p  =  0.3275911;
            const sign = (x >= 0) ? 1 : -1;
            x = Math.abs(x);
            const t = 1.0/(1.0 + p*x);
            const y = 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*Math.exp(-x*x);
            return sign*y;
        };

        function updateCalculations() {
            const stockPrice = parseFloat(document.getElementById('stockPrice').value);
            const strikePrice = parseFloat(document.getElementById('strikePrice').value);
            const daysToExpiry = parseFloat(document.getElementById('daysToExpiry').value);
            const volatility = parseFloat(document.getElementById('volatility').value);
            const riskFreeRate = parseFloat(document.getElementById('riskFreeRate').value);
            const optionPrice = parseFloat(document.getElementById('optionPrice').value);

            // Calculate metrics
            const breakEven = strikePrice + optionPrice;
            const maxLoss = optionPrice * 100; // Per contract (100 shares)
            const roi = ((breakEven - stockPrice) / optionPrice - 1) * 100;

            // Calculate probability using delta
            const delta = calculateDelta(
                stockPrice,
                strikePrice,
                daysToExpiry / 365,
                volatility / 100,
                riskFreeRate / 100
            );
            const profitProb = (1 - delta) * 100;

            // Update display
            document.getElementById('breakEven').textContent = `$${breakEven.toFixed(2)}`;
            document.getElementById('maxLoss').textContent = `$${maxLoss.toFixed(2)}`;
            document.getElementById('roi').textContent = `${roi.toFixed(2)}%`;
            document.getElementById('profitProb').textContent = `${profitProb.toFixed(2)}%`;

            // Update chart
            const priceRange = [];
            const profitRange = [];
            const minPrice = stockPrice * 0.8;
            const maxPrice = stockPrice * 1.2;
            const steps = 40;
            const stepSize = (maxPrice - minPrice) / steps;

            for (let price = minPrice; price <= maxPrice; price += stepSize) {
                priceRange.push(price.toFixed(2));
                const profit = price > strikePrice 
                    ? (price - strikePrice - optionPrice) * 100
                    : -optionPrice * 100;
                profitRange.push(profit);
            }

            profitChart.data.labels = priceRange;
            profitChart.data.datasets[0].data = profitRange;
            profitChart.update();
        }

        // Add event listeners to all inputs
        document.querySelectorAll('.input-field').forEach(input => {
            input.addEventListener('input', updateCalculations);
        });

        // Initial calculation
        updateCalculations();
    </script>
</body>
</html>